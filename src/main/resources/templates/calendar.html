<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Calendar</title>
    <link rel="stylesheet" th:href="@{/webjars/semantic-ui/2.2.6/dist/semantic.min.css}"
          href="/webjars/semantic-ui/2.2.6/dist/semantic.min.css"/>
    <link rel="stylesheet" th:href="@{/webjars/fullcalendar/3.1.0/dist/fullcalendar.min.css}"
          href="/webjars/fullcalendar/3.1.0/dist/fullcalendar.min.css"/>
    <link rel="stylesheet" th:href="@{/webjars/air-datepicker/2.2.0/dist/css/datepicker.min.css}"
          href="/webjars/air-datepicker/2.2.0/dist/css/datepicker.min.css"/>
    <script th:src="@{/webjars/jquery/3.1.1/dist/jquery.min.js}"
            src="/webjars/jquery/3.1.1/dist/jquery.min.js"></script>
    <script th:src="@{/webjars/semantic-ui/2.2.6/dist/semantic.min.js}"
            src="/webjars/semantic-ui/2.2.6/dist/semantic.min.js"></script>
    <script th:src="@{/webjars/moment/2.17.1/min/moment.min.js}"
            src="/webjars/moment/2.17.1/min/moment.min.js"></script>
    <script th:src="@{/webjars/fullcalendar/3.1.0/dist/fullcalendar.min.js}"
            src="/webjars/fullcalendar/3.1.0/dist/fullcalendar.min.js"></script>
    <script th:src="@{/webjars/air-datepicker/2.2.0/dist/js/datepicker.min.js}"
            src="/webjars/air-datepicker/2.2.0/dist/js/datepicker.min.js"></script>
</head>
<body>
<header th:include="fragments :: header">
</header>
<div class="ui divider"></div>
<div class="ui small modal">
    <div class="content">
        <div class="ui grid">
            <input id="eventId" hidden="hidden"/>
            <div class="thirteen wide column">
                <div class="ui input">
                    <input type="text" placeholder="Сумма"/>
                </div>
                <button id="pay" class="ui positive basic button" onclick="eventPay()">Заплатить</button>
            </div>
            <div class="one wide column">
                <button class="ui button red" onclick="deleteEvent()">Delete</button>
            </div>
        </div>
    </div>
</div>
<div class="ui grid">
    <div class="ui twelve wide column">
        <div id="calendar"></div>
    </div>
    <div class="ui four wide column">
        <form class="ui form">
            <div class="field">
                <label for="title">Title</label>
                <input type="text" id="title" placeholder="Title"/>
            </div>
            <div class="field">
                <label for="start">Start</label>
                <input type='text' id="start"/>
            </div>
            <div class="field">
                <label for="end">End</label>
                <input type='text' id="end"/>
            </div>
            <button id="eventSave" class="ui button primary" onclick="saveEvent()">Save</button>
        </form>
    </div>
</div>
</body>
<script>
    var url = "/event/";
    var calendar;

    function saveEvent() {
        $.ajax({
            type: "POST",
            url: url,
            data: {
                title: $("#title").val(),
                start: $("#start").val().replace(" ", "T"),
                end: $("#end").val().replace(" ", "T")
            },
            success: function () {
                clearFormFields();
            }
        });
    }

    function eventPay() {
        $(".ui.modal").modal("hide");
    }

    function deleteEvent() {
        var eventId = $("#eventId").val();
        $.ajax({
            type: "DELETE",
            url: url + eventId,
            success: function () {
                calendar.fullCalendar('removeEvents', eventId);
                $(".ui.modal").modal("hide");
            }
        });
    }

    function clearFormFields() {
        $("#title").val("");
        $("#start").val("");
        $("#end").val("");
    }

    function updateEvent(event) {
        $.ajax({
            type: "POST",
            url: url,
            data: {
                id: event.id,
                title: event.title,
                start: event.start.format(),
                end: event.end.format()
            }
        });
    }

    $(document).ready(function () {
        $("#start").datepicker({
            timepicker: true,
            minDate: new Date(),
            minHours: 9,
            dateFormat: 'yyyy-mm-dd',
        });
        $("#end").datepicker({
            timepicker: true,
            minDate: new Date(),
            minHours: 9,
            dateFormat: 'yyyy-mm-dd',
        });

        calendar = $('#calendar').fullCalendar({
            events: "/event/all",
            header: {
                left: 'agendaWeek,month',
                center: 'title',
                right: 'today,prev,next'
            },
            buttonText: {
                today: 'Сегодня',
                month: 'Месяц',
                week: 'Неделя',
                day: 'День',
                list: 'Список'
            },
            allDaySlot: false,
            monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль',
                'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
            monthNamesShort: ['Янв.', 'Фев.', 'Мрт', 'Апр.', 'Май', 'Июн.',
                'Июл.', 'Авг.', 'Сен.', 'Окт.', 'Нбр', 'Дек.'],
            dayNames: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг',
                'Пятница', 'Суббота'],
            dayNamesShort: ['Вс.', 'Пн.', 'Вт.', 'Ср.', 'Чт.', 'Пт.', 'Сб.'],
            firstDay: 1,
            weekNumbers: true,
            weekNumberTitle: 'Н',
            timeFormat: 'H(:mm)',
            slotLabelFormat: 'H(:mm)',
            minTime: "9:00:00",
            height: 600,
            editable: true,
            eventDrop: function (event, delta, revertFunc) {
                updateEvent(event);
            },
            eventResize: function (event, delta, revertFunc) {
                updateEvent(event);
            },
            eventClick: function (calEvent, jsEvent, view) {
                $("#eventId").val(calEvent.id);
                $(".ui.modal").modal({
                    blurring: true
                }).modal("show");
            }
        });
    });
</script>
</html>